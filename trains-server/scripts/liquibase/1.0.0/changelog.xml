<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd
                      http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

  <!--    <changeSet id="1" author="Paul">-->
  <!--      <sql>-->
  <!--        CREATE EXTENSION IF NOT EXISTS "uuid-ossp";-->
  <!--        CREATE EXTENSION IF NOT EXISTS "pgcrypto";-->
  <!--        CREATE EXTENSION IF NOT EXISTS "autoinc";-->
  <!--        CREATE EXTENSION IF NOT EXISTS "cube";-->
  <!--        CREATE EXTENSION IF NOT EXISTS "earthdistance";-->
  <!--        ALTER USER trains WITH NOSUPERUSER;-->
  <!--      </sql>-->
  <!--      &lt;!&ndash; impossible to rollback this one, but if it got this far with the rollback, just
  rerun create.sql &ndash;&gt;-->
  <!--    </changeSet>-->

  <changeSet id="99" author="Paul">
    <tagDatabase tag="initial" />
  </changeSet>

  <changeSet id="100" author="Paul">
    <createTable tableName="USERS">
      <column name="ID" type="${uuid_type}" defaultValueComputed="${uuid_function}">
        <constraints primaryKey="true" nullable="false" />
      </column>
      <column name="VERSION" type="INTEGER" defaultValue="0" />
      <column name="CREATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="UPDATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="DELETED" type="DATETIME" />
      <column name="USERNAME" type="VARCHAR(50)">
        <constraints nullable="false" />
      </column>
      <column name="PASSWORD" type="VARCHAR(512)">
        <constraints nullable="false" />
      </column>
      <column name="EMAIL" type="VARCHAR(512)">
        <constraints nullable="false" />
      </column>
      <column name="SCOPE" type="VARCHAR(20)" defaultValue="USERS"> </column>
    </createTable>
  </changeSet>

  <changeSet id="110" author="Paul">
    <createIndex tableName="USERS" indexName="USERS_NAME" unique="true">
      <column name="USERNAME" />
    </createIndex>
  </changeSet>

  <changeSet id="120" author="Paul">
    <createIndex tableName="USERS" indexName="USERS_EMAIL" unique="true">
      <column name="EMAIL" />
    </createIndex>
  </changeSet>

  <changeSet id="199" author="Paul">
    <loadUpdateData
            primaryKey="id"
            encoding="UTF-8"
            file="../data/users.csv"
            quotchar="'"
            relativeToChangelogFile="true"
            separator=","
            tableName="USERS"
    >
      <column header="id" name="ID" type="varchar(36)" />
      <column header="version" name="VERSION" type="INTEGER" />
      <column header="created" name="CREATED" type="DATETIME" />
      <column header="updated" name="UPDATED" type="DATETIME" />
      <column header="deleted" name="DELETED" type="DATETIME" />
      <column header="username" name="USERNAME" type="VARCHAR(50)" />
      <column header="password" name="PASSWORD" type="VARCHAR(512)" />
      <column header="email" name="EMAIL" type="VARCHAR(512)" />
      <column header="scope" name="SCOPE" type="VARCHAR(20)" />
    </loadUpdateData>
  </changeSet>


  <changeSet id="200" author="Paul">
    <createTable tableName="PLACES">
      <column name="ID" type="${uuid_type}" defaultValueComputed="${uuid_function}">
        <constraints primaryKey="true" nullable="false" />
      </column>
      <column name="VERSION" type="INTEGER" defaultValue="0" />
      <column name="CREATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="UPDATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="DELETED" type="DATETIME" />
      <column name="NAME" type="VARCHAR(100)">
        <constraints nullable="false" />
      </column>
      <column name="DESCRIPTION" type="VARCHAR(250)">
        <constraints nullable="false" />
      </column>
      <column name="TYPE" type="VARCHAR(20)">
        <constraints nullable="false" />
      </column>
      <column name="LAT" type="FLOAT">
        <constraints nullable="false" />
      </column>
      <column name="LONG" type="FLOAT">
        <constraints nullable="false" />
      </column>
      <column name="CONTENT" type="JSON" />
    </createTable>
  </changeSet>

  <changeSet id="210" author="Paul">
    <createIndex tableName="PLACES" indexName="POINTS_NAME">
      <column name="NAME" />
    </createIndex>
  </changeSet>

  <changeSet id="299" author="Paul">
    <loadUpdateData
        primaryKey="id"
        encoding="UTF-8"
        file="../data/places.csv"
        quotchar="'"
        relativeToChangelogFile="true"
        separator=","
        tableName="PLACES"
        >
      <column header="id" name="ID" type="varchar(36)" />
      <column header="version" name="VERSION" type="INTEGER" />
      <column header="created" name="CREATED" type="DATETIME" />
      <column header="updated" name="UPDATED" type="DATETIME" />
      <column header="deleted" name="DELETED" type="DATETIME" />
      <column header="name" name="NAME" type="VARCHAR(100)" />
      <column header="description" name="DESCRIPTION" type="VARCHAR(250)" />
      <column header="type" name="TYPE" type="VARCHAR(20)" />
      <column header="lat" name="LAT" type="FLOAT" />
      <column header="long" name="Long" type="FLOAT" />
      <column header="content" name="CONTENT" type="JSON" />
    </loadUpdateData>
  </changeSet>

  <changeSet id="300" author="Paul">
    <createTable tableName="POSTS">
      <column name="ID" type="${uuid_type}" defaultValueComputed="${uuid_function}">
        <constraints primaryKey="true" nullable="false" />
      </column>
      <column name="VERSION" type="INTEGER" defaultValue="0" />
      <column name="CREATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="UPDATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="DELETED" type="DATETIME" />
      <column name="TITLE" type="VARCHAR(100)">
        <constraints nullable="false" />
      </column>
      <column name="CONTENT" type="VARCHAR(250)">
        <constraints nullable="false" />
      </column>
    </createTable>
  </changeSet>

  <changeSet id="400" author="Paul">
    <createTable tableName="TRANSLATIONS">
      <column name="ID" type="${uuid_type}" defaultValueComputed="${uuid_function}">
        <constraints primaryKey="true" nullable="false" />
      </column>
      <column name="VERSION" type="INTEGER" defaultValue="0" />
      <column name="CREATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="UPDATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="DELETED" type="DATETIME" />
      <column name="LANGUAGE" type="VARCHAR(10)">
        <constraints nullable="false" />
      </column>
      <column name="KEY" type="VARCHAR(250)">
        <constraints nullable="false" />
      </column>
      <column name="CONTENT" type="VARCHAR(2000)">
        <constraints nullable="false" />
      </column>
    </createTable>
  </changeSet>

  <changeSet id="700" author="Paul">
    <createTable tableName="VEHICLES">
      <column name="ID" type="${uuid_type}" defaultValueComputed="${uuid_function}">
        <constraints primaryKey="true" nullable="false" />
      </column>
      <column name="VERSION" type="INTEGER" defaultValue="0" />
      <column name="CREATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="UPDATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="DELETED" type="DATETIME" />

      <column name="TYPE" type="VARCHAR(20)">
        <constraints nullable="false" />
      </column>
      <column name="NAME" type="VARCHAR(250)">
        <constraints nullable="false" />
      </column>
      <column name="DESCRIPTION" type="VARCHAR(250)" />

      <column name="ENGINE_MAX" type="INTEGER" defaultValue="1" />
      <column name="AUX_MAX" type="INTEGER" defaultValue="0" />

      <column name="ENGINE_LOAD" type="INTEGER" defaultValue="1" />
      <column name="ENGINE_FUEL" type="INTEGER" defaultValue="50" />

      <column name="AUX_LOAD" type="INTEGER" defaultValue="1" />
      <column name="AUX_FUEL" type="INTEGER" defaultValue="50" />

      <column name="SPEED" type="INTEGER" defaultValue="10" />

      <column name="CONTENT" type="JSON"> </column>
    </createTable>
  </changeSet>

  <changeSet id="720" author="Paul">
    <createIndex tableName="VEHICLES" indexName="VEHICLES_NAME" unique="true">
      <column name="NAME" />
    </createIndex>
  </changeSet>

  <changeSet id="799" author="Paul">
    <loadUpdateData
            primaryKey="id"
            encoding="UTF-8"
            file="../data/vehicles.csv"
            quotchar="&quot;"
            relativeToChangelogFile="true"
            separator=","
            tableName="VEHICLES"
    >
      <column header="id" name="ID" type="varchar(36)" />
      <column header="version" name="VERSION" type="INTEGER" />
      <column header="created" name="CREATED" type="DATETIME" />
      <column header="updated" name="UPDATED" type="DATETIME" />
      <column header="deleted" name="DELETED" type="DATETIME" />
      <column header="type" name="TYPE" type="VARCHAR(20)" />
      <column header="name" name="NAME" type="VARCHAR(250)" />
      <column header="description" name="DESCRIPTION" type="VARCHAR(250)" />
      <column header="engine_max" name="ENGINE_MAX" type="INTEGER" />
      <column header="engine_load" name="ENGINE_LOAd" type="INTEGER" />
      <column header="engine_fuel" name="ENGINE_FUEL" type="INTEGER" />
      <column header="aux_max" name="AUX_MAX" type="INTEGER" />
      <column header="aux_load" name="AUX_LOAD" type="INTEGER" />
      <column header="aux_fuel" name="AUX_FUEL" type="INTEGER" />
      <column header="speed" name="SPEED" type="INTEGER" />
      <column header="content" name="CONTENT" type="JSON" />
    </loadUpdateData>
  </changeSet>

  <changeSet id="800" author="Paul">
    <createTable tableName="PLACE_CONNECTIONS">
      <column name="ID" type="${uuid_type}" defaultValueComputed="${uuid_function}">
        <constraints primaryKey="true" nullable="false" />
      </column>
      <column name="VERSION" type="INTEGER" defaultValue="0" />
      <column name="CREATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="UPDATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="DELETED" type="DATETIME" />

      <column name="TYPE" type="VARCHAR(20)">
        <constraints nullable="false" />
      </column>
      <column name="NAME" type="VARCHAR(250)">
        <constraints nullable="false" />
      </column>
      <column name="DESCRIPTION" type="VARCHAR(250)" />

      <column name="START" type="${uuid_type}">
        <constraints nullable="false" />
      </column>

      <column name="END" type="${uuid_type}">
        <constraints nullable="false" />
      </column>

      <column name="CONTENT" type="JSON"> </column>
    </createTable>
  </changeSet>

  <changeSet id="810" author="Paul">
    <addForeignKeyConstraint
            constraintName="PLACE_CONNECTIONS_START_PLACES"
            baseTableName="PLACE_CONNECTIONS"
            baseColumnNames="START"
            referencedTableName="PLACES"
            referencedColumnNames="ID" />
  </changeSet>

  <changeSet id="820" author="Paul">
    <addForeignKeyConstraint
            constraintName="PLACE_CONNECTIONS_END_PLACES"
            baseTableName="PLACE_CONNECTIONS"
            baseColumnNames="END"
            referencedTableName="PLACES"
            referencedColumnNames="ID" />
  </changeSet>

  <changeSet id="899" author="Paul">
    <loadUpdateData
            primaryKey="id"
            encoding="UTF-8"
            file="../data/place_connections.csv"
            quotchar="&quot;"
            relativeToChangelogFile="true"
            separator=","
            tableName="PLACE_CONNECTIONS"
    >
      <column header="id" name="ID" type="varchar(36)" />
      <column header="version" name="VERSION" type="INTEGER" />
      <column header="created" name="CREATED" type="DATETIME" />
      <column header="updated" name="UPDATED" type="DATETIME" />
      <column header="deleted" name="DELETED" type="DATETIME" />
      <column header="type" name="TYPE" type="VARCHAR(20)" />
      <column header="name" name="NAME" type="VARCHAR(250)" />
      <column header="description" name="DESCRIPTION" type="VARCHAR(250)" />
      <column header="start" name="START" type="varchar(36)" />
      <column header="end" name="END" type="varchar(36)" />
      <column header="content" name="CONTENT" type="JSON" />
    </loadUpdateData>
  </changeSet>

  <changeSet id="900" author="Paul">
    <createTable tableName="JOBS">
      <column name="ID" type="${uuid_type}" defaultValueComputed="${uuid_function}">
        <constraints primaryKey="true" nullable="false" />
      </column>
      <column name="VERSION" type="INTEGER" defaultValue="0" />
      <column name="CREATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="UPDATED" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>
      <column name="DELETED" type="DATETIME" />

      <column name="TYPE" type="VARCHAR(20)">
        <constraints nullable="false" />
      </column>
      <column name="NAME" type="VARCHAR(250)">
        <constraints nullable="false" />
      </column>
      <column name="DESCRIPTION" type="VARCHAR(250)" />

      <column name="START" type="${uuid_type}">
        <constraints nullable="false" />
      </column>

      <column name="END" type="${uuid_type}">
        <constraints nullable="false" />
      </column>

      <column name="LOAD" type="INTEGER" defaultValue="1" />

      <column name="PAY_TYPE" type="VARCHAR(20)" defaultValue="GOLD" />

      <column name="PAY" type="INTEGER" defaultValue="100" />

      <column name="START_TIME" type="DATETIME" defaultValueComputed="now()">
        <constraints nullable="false" />
      </column>

      <column name="CONTENT" type="JSON"> </column>
    </createTable>
  </changeSet>

  <changeSet id="910" author="Paul">
    <addForeignKeyConstraint
            constraintName="JOBS_START_PLACES"
            baseTableName="JOBS"
            baseColumnNames="START"
            referencedTableName="PLACES"
            referencedColumnNames="ID" />
  </changeSet>

  <changeSet id="920" author="Paul">
    <addForeignKeyConstraint
            constraintName="JOBS_END_PLACES"
            baseTableName="JOBS"
            baseColumnNames="END"
            referencedTableName="PLACES"
            referencedColumnNames="ID" />
  </changeSet>

  <changeSet id="930" author="Paul">
    <sql>
      ALTER TABLE JOBS ADD CONSTRAINT CK_JOBS_TYPE CHECK (TYPE IN ('DELIVERY', 'PASSENGER', 'REPAIR', 'RESCUE', 'TOW'));
    </sql>
    <rollback>
      <sql>
        ALTER TABLE JOBS DROP CONSTRAINT CK_JOBS_TYPE;
      </sql>
    </rollback>
  </changeSet>

  <changeSet id="940" author="Paul">
    <sql>
      ALTER TABLE JOBS ADD CONSTRAINT CK_JOBS_PAY_TYPE CHECK (PAY_TYPE IN ('GOLD', 'TOKEN', 'CRATE', 'MATERIAL'));
    </sql>
    <rollback>
      <sql>
        ALTER TABLE JOBS DROP CONSTRAINT CK_JOBS_PAY_TYPE;
      </sql>
    </rollback>
  </changeSet>

</databaseChangeLog>
